![IWTE banner](../IWTEgithub_images/IWTEbanner.jpg)

# M2TW vegetation.db 

In M2TW the vegetation.db file will be found in *data/vegetation* folder.  In RTW descr_vegetation.txt and descr_vegetation.db are found in the *data* folder, RTW will regenerate the db file from the text file.

The vegetation.db in M2TW is not regenerated by the game, IWTE functions have been developed to allow editing of the db.  RTW's inbuilt method of generating the vegetation db file from the text file also produces its required models and sprites so IWTE is not required for RTW vegetation.db changes.

#### Table of Contents

* [Adding items to the vegetation.db](adding-items-to-the-vegetationdb)
* [Editing the vegetation.db in IWTE](#editing-the-vegetationdb-in-iwte)
* [Editing the vegetation.db via text](#editing-the-vegetationdb-via-text)
* [Creating Vege_Models](#creating-vege_models)
* [Creating Vege_Sprites](#creating-vege_sprites)

## Adding items to the vegetation.db

Use the IWTE screen/button ***Veg/GeogDB > Edit Vegmodel List*** and open your vegetation.db then select either:
* Add New Vegetation model
* Delete Vegetation model or
* Change veg model name

![M2-vegetation-db-list](../IWTEgithub_images/M2-vegetation-db-list.jpg)

When adding items the model must end .vege_model and the sprite must end .vege_sprite, please ensure the names given correctly match the models/sprites in your mod. Missing items will crash the game.

Selecting 'OK - write files' will generate a new file with name ending -1.db to avoid accidental overwrites, re-name it to be used in game.

## Editing the vegetation.db in IWTE

Once your list contains all the items you want you can adjust where they are used in game. 
Use the IWTE screen/button ***Veg/GeogDB > Edit Vegetation.db*** and load the .db file you have updated.

![M2-vegetation-db-edit](../IWTEgithub_images/M2-vegetation-db-edit.jpg)

You can adjust the models and settings used for each climate's summer and winter.  The models are selected by drop-down which includes the entire contents of your vegmodel list.  You can have up to 4 models per vegetation type.  Note that not all vegetation types appear to be used in game.  Cactii are useable and can be set to add less common tree models. Mangroves  and water_cover are only displayed around water.  The radius setting can help stop troops walking through large objects such as rocks, however it appears to be limited in scope, setting values from 10 to 99m resulted in the same sized blocked area as shown in the picture below.

![max-block-size.jpg](../IWTEgithub_images/max-block-size.jpg)

The Veg Distance Table gives the viewing distance for models and sprites at Low/Medium/High quality settings.  'None' in any of the boxes means that the item will not be displayed at all at that quality setting. Infinity means the item will not switch off in distant views.

![M2-vegetation-db-veg-distance](../IWTEgithub_images/M2-vegetation-db-veg-distance.jpg)



## Editing the vegetation.db via text

There are some complex sections of the vegetation.db which cannot be edited via the IWTE screen. To change these other aspects use the screen/button ***Veg/GeogDB > Write VegDB text*** to generate a text file, edit it as required and use ***Veg/GeogDB > Read VegDB text*** to update a vegetation.db file with your changes.

The aspect you're most likely to need to change via the text method is the grass, please see the tutorial:  
https://www.twcenter.net/forums/showthread.php?657346-Re-Grass-editing-in-vegetation-db

## Creating Vege_Models

See TWC tutorial for creation of vege_models using Milkshape https://www.twcenter.net/forums/showthread.php?577141-IWTE-Vegetation-editing  

To convert a vege_model to dae/glb/ms3d, check the extract file type you want is selected in the drop-down box then use ***Medieveal 2 > Vegetation models and sprites > Vege_model_to_extract***.  

![M2_vege_model_to_extract](../IWTEgithub_images/M2_vege_model_to_extract.jpg)

NOTE:  Do not allow uv maps for the vege_models to exceed the 0 to 1 range.  Do not use textures for the vege_models that are larger than other vegetation textures.  The game compiles all the vegetation textures into one texture map in game, change of size or uv's exceeding range will result in models using parts of other models textures!

## Creating Vege_Sprites

The Vege_Sprites are small binary files that list a diffuse and a normal texture and give coordinates to be used within those textures for 8 possible viewpoints.  The picture below shows the vanilla textures for the willow sprite.  Note that the 'normal' texture is nothing like the sort of normal map produced by the nvidia plug-in, the information on it is taken from the models geometry and not a translation of the diffuse texture.  

![M2_vegsprite_textures](../IWTEgithub_images/M2_vegsprite_textures.jpg)

The image below shows sprite textures created by IWTE from the same model. Both textures are created from dds files with mip-maps.  Due to the tendency to blur in mip-maps you tend to get better results if the image background colour is close to the objects colour, therefore IWTE tries to use adjacent colours for the background.

![M2_vegsprite_textures_IWTE](../IWTEgithub_images/M2_vegsprite_textures_IWTE.jpg)

To produce a vege_sprite using IWTE use the screen/button ***Veg/GeogDB > Create VegSprite***.  Select the .vege_model you want a sprite for, the .texture it uses should be available in a *textures* sub-folder below the model.

For model_name.vege_model IWTE will produce:
* IWTEsave/model_name.vege_sprite
* IWTEsave/model_name_**diff**.tga
* IWTEsave/model_name_**norm**.tga
* IWTEsave/textures/model_name_**diff**.textures
* IWTEsave/textures/model_name_**norm**.textures
  
If you want to alter the sprite images use the .tga files and process them to .dds/texture.  If you're happy with them just use the .texture files and transfer them and the .vege_sprite to the folders:
* data/vegetation/sprites
* data/vegetation/sprites/diffuse_maps
* data/vegetation/sprites/normal_maps
 
IWTE adds _diff and _norm to the diffuse and normal textures for ease of identification. The vege_sprite produced will be set up for this naming, the names do not need to be changed.  The .vege_sprite contains uv type dimension information telling the game which portions of the textures to display, this is set by IWTE at the same time as the texture generation, mismatching sprites and textures from different models can result in very odd results!

There are also Vege_Sprite editing options *VegSprite to text* and *Text to VegSprite* - you are unlikely to need to use or understand these unless something has gone wrong with the sprite creation process and you need to make adjustments.
